%% Infra Overview â€” AgentCore (C4/C2-ish)
%% Render with Mermaid CLI or in GitHub preview

graph TD
  subgraph Identity [Cognito Identity]
    UP[("User Pool")]
    M2M["App Client (client_credentials)"]
    FE["Frontend Client (code + PKCE)"]
  end

  subgraph FrontendGW [Frontend Gateway]
    FEGW["API Gateway (HTTP)"]
    FELambda["Auth/Proxy Lambda"]
    FERole["Lambda IAM Role"]
  end

  subgraph Gateway [Bedrock AgentCore Gateway]
    GW[("Gateway")]
    GRole[Gateway IAM Role]
  end

  subgraph Tools [Global MCP Tools]
    T1[check_warranty Lambda]
    T2[web_search Lambda]
  end

  subgraph Runtime [Agent Runtime]
    RuntimeSvc["AgentCore Runtime"]
    RRole[Execution IAM Role]
    Logs["/CW Log Group/"]
  end

  subgraph Memory [Bedrock AgentCore Memory]
    MEM[("Memory Service")]
  end

  subgraph Observability [Observability]
    CW[("CloudWatch")]
    XR[("X-Ray")]
  end

  UP --> M2M
  UP --> FE
  FE -->|JWT| FEGW
  FEGW --> FELambda
  FELambda -->|Validate| UP
  FELambda -->|InvokeAgentRuntime API| RuntimeSvc
  RuntimeSvc -->|IAM Role| RRole

  RRole -->|Invoke| GW
  GW -->|Invoke Tool| T1
  GW -->|Invoke Tool| T2

  RRole -->|Read| MEM

  RRole --> Logs
  FELambda --> CW
  T1 --> CW
  T2 --> CW
  GW --> CW

  RRole --> XR
  FELambda --> XR
  T1 --> XR
  T2 --> XR
  GW --> XR

  classDef aws fill:#f7fbff,stroke:#1f77b4,stroke-width:1px
  class UP,M2M,FE,GW,GRole,T1,T2,RuntimeSvc,RRole,Logs,MEM,CW,XR aws
